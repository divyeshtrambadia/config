/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/base/Object','sap/ui/base/EventProvider'],function(q,O,E){"use strict";var e=new E(),_={},a={},b={},c={},C,d=[];var H=O.extend("HeaderAdapter",{constructor:function(h,A){if(!h||!A){q.sap.log.error("Cannot initialize: Invalid arguments.");return;}this._oHeader=h;this._oTitleInfo=null;this._oSubTitleInfo=null;this._oBackButton=null;this._oAdaptOptions=A;}});H.prototype.adapt=function(){var s=this._oAdaptOptions.bStylePage,g=this._oAdaptOptions.bCollapseHeader;if(s){this._adaptStyle("sapF2Adapted");}var t=this._adaptTitle(this._oAdaptOptions),B=this._adaptBackButton(this._oAdaptOptions);if(g){this._collapseHeader(t,B);}return{bTitleHidden:t,bBackButtonHidden:B};};H.prototype.getAdaptedContent=function(){return{oTitleInfo:this._oTitleInfo,oSubTitleInfo:this._oSubTitleInfo,bBackButton:this._oBackButton};};H.prototype._adaptTitle=function(){if(!this._isStandardHeader(this._oHeader)||this._oAdaptOptions.bMoveTitle!==true){return false;}this._oTitleInfo=this._detectTitle();this._oSubTitleInfo=this._detectSubTitle();var s=this._oTitleInfo||this._oSubTitleInfo;if(this._oTitleInfo){this._oTitleInfo.oControl.addStyleClass("sapF2AdaptedTitle");}return s;};H.prototype._adaptBackButton=function(){if(!this._isStandardHeader(this._oHeader)||this._oAdaptOptions.bHideBackButton!==true){return false;}var B=false;this.oBackButton=this._detectBackButton();if(this.oBackButton){this.oBackButton.addStyleClass("sapF2AdaptedNavigation");B=true;}return B;};H.prototype._adaptStyle=function(s){var p=this._oHeader.getParent();if(p){p.addStyleClass(s,true);}};H.prototype._isStandardHeader=function(h){return h&&f(h,"sap/m/Bar");};H.prototype._detectTitle=function(){var t;if(this._isStandardHeader(this._oHeader)){var m=this._oHeader.getContentMiddle();if(m.length===1&&i(m[0])){var T=m[0];t={id:T.getId(),text:T.getText(),oControl:T,sChangeEventId:"_change"};}}return t;};H.prototype._detectSubTitle=function(p){if(f(p,"sap/uxap/ObjectPageHeader")){var h=p.getHeaderTitle();if(h){return{id:h.getId(),text:h.getObjectTitle(),oControl:h,sChangeEventId:"_titleChange"};}}};H.prototype._detectBackButton=function(){if(this._isStandardHeader(this._oHeader)){var B=this._oHeader.getContentLeft();if(B.length>0&&f(B[0],"sap/m/Button")&&(B[0].getType()==="Back"||B[0].getType()==="Up"||B[0].getIcon()==="sap-icon://nav-back")){return B[0];}}};H.prototype._collapseHeader=function(t,B){if(this._isStandardHeader(this._oHeader)){var g=this._oHeader.getContentLeft();var m=this._oHeader.getContentMiddle();var h=this._oHeader.getContentRight();if((g.length===0||(g.length===1&&B))&&(m.length===0||(m.length===1&&t))&&(h.length===0)){this._adaptStyle("sapF2CollapsedHeader");}}};var F=O.extend("sap.m.Fiori20Adapter",{});F.attachViewChange=function(l){e.attachEvent("viewChange",l);};F.detachViewChange=function(l){e.detachEvent("viewChange",l);};F.traverse=function(r,A){this._doBFS([{oNode:r,oAdaptOptions:A}]);};F._doBFS=function(Q){var n=Q.shift();if(!n){return;}var N=n.oNode,A=n.oAdaptOptions,s=A.iSearchDepth;A=this._applyRules(A,N);if(!N||!this._isAdaptationRequired(A)||(s<=0)){return;}var o=this._processNode(N,A);var g=this._getNodeChildren(N),h=q.extend({},A,{iSearchDepth:this._updateSearchDepth(s,N)});if(o){h=q.extend(h,{bMoveTitle:A.bMoveTitle&&!o.bTitleHidden,bHideBackButton:A.bHideBackButton&&!o.bBackButtonHidden});}g.forEach(function(j){if(j){Q.push({oNode:j,oAdaptOptions:h});}});this._doBFS(Q);};F._processNode=function(o,A){if(o._getAdaptableContent&&q.isFunction(o._getAdaptableContent)){o.attachEvent("_adaptableContentChange",function(h){var j=h.getParameter("adaptableContent");this._adaptContent(j,o,A);}.bind(this));if(f(o,"sap/m/Page")){o._attachModifyAggregation("content",A,function(h){var T=h.getParameter("type"),j=h.getParameter("object");if((T==="add")||(T==="insert")){this.traverse(j,A);}},this);}if(f(o,"sap/m/NavContainer")){o.attachNavigate(function(h){this._adaptNavigableView(h.getParameter("to"),A);}.bind(this));}return this._adaptContent(o._getAdaptableContent(),o,A);}if(f(o,"sap/ui/core/ComponentContainer")){var g=o.getComponentInstance();if(!g&&o.getName()&&!o.getDomRef()){var t=this;var D={onBeforeRendering:function(){o.removeEventDelegate(D);t.traverse(o.getComponentInstance(),A);}};o.addEventDelegate(D,this);}}};F._getNodeChildren=function(o){if(f(o,"sap/m/NavContainer")){return[o.getCurrentPage()];}if(f(o,"sap/m/SplitContainer")){return[].concat(o.getAggregation("_navMaster"),o.getAggregation("_navDetail"));}if(f(o,"sap/m/Page")){return o.getContent();}if(f(o,"sap/uxap/ObjectPageLayout")){return[o.getHeaderTitle()];}if(f(o,"sap/ui/core/ComponentContainer")){return[o.getComponentInstance()];}if(f(o,"sap/ui/core/Component")){return[o.getAggregation("rootControl")];}return o.findAggregatedObjects(false);};F._updateSearchDepth=function(s,o){if(f(o,"sap/ui/core/mvc/View")||f(o,"sap/ui/core/Component")||f(o,"sap/ui/core/ComponentContainer")){return s;}return s-1;};F._skipDoneAdaptations=function(A){A=q.extend({},A);if(c[C]){A.bStylePage=false;}if(_[C]){A.bMoveTitle=false;}if(b[C]){A.bHideBackButton=false;}return A;};F._applyRules=function(A,o){var p=o.getParent();if(f(p,"sap/m/SplitContainer")){var I=sap.ui.Device.system.phone,m=A.bMoveTitle,g;if(m){m=I;}var g=A.bHideBackButton;if(g&&!sap.ui.Device.system.phone){g='initialPage';}return q.extend({},A,{bMoveTitle:m,bHideBackButton:g});}if(f(p,"sap/m/NavContainer")){if(A.bHideBackButton==='initialPage'){var h=p._getActualInitialPage()&&(p._getActualInitialPage().getId()===o.getId());return q.extend({},A,{bHideBackButton:h});}}return A;};F._adaptContent=function(o,p,A){if(f(p,"sap/m/Page")||f(p,"sap/uxap/ObjectPageHeader")){return this._adaptHeader(o,A);}if(f(p,"sap/m/NavContainer")){return this._adaptNavigableView(o,A);}};F._adaptHeader=function(h,A){if(!h||!A){return;}var o=new H(h,A),r=o.adapt(),g=o.getAdaptedContent();if(g.oTitleInfo){_[C]=g.oTitleInfo;this._registerChangeListener(_,C);}if(g.oSubTitleInfo){a[C]=g.oSubTitleInfo;this._registerChangeListener(a,C);}if(g.oBackButton){b[C]=g.oBackButton;}return r;};F._registerChangeListener=function(t,v){var T=t[v];if(T&&T.oControl&&T.sChangeEventId&&!d[T.id]){var g=function(o){var T=t[v];T.text=o.getParameter("newValue");this._fireViewChange(v);}.bind(this);T.oControl.attachEvent(T.sChangeEventId,g);d[T.id]=g;}};F._fireViewChange=function(v){e.fireEvent("viewChange",{sViewId:v,oTitleInfo:_[v],oSubTitleInfo:a[v],oBackButton:b[v]});};F._adaptNavigableView=function(v,A){if(!v||!A){return;}C=v.getId();if(c[C]){A=this._skipDoneAdaptations(A);}A=q.extend({},A,{iSearchDepth:A.iSearchDepth-1});this.traverse(v,A);c[C]=v;this._fireViewChange(C);};F._isAdaptationRequired=function(A){for(var o in A){if(A.hasOwnProperty(o)&&(A[o]===true)){return true;}}return false;};function i(o){if(!o){return false;}return f(o,"sap/m/Label")||f(o,"sap/m/Text")||f(o,"sap/m/Title");}function f(o,t){var T=sap.ui.require(t);return T&&(o instanceof T);}return F;},false);
